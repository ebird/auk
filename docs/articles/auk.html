<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>auk: eBird Data Processing with AWK • auk</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">auk</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>auk: eBird Data Processing with AWK</h1>
            
          </div>

    
    
<div class="contents">
<p><a href="http://www.ebird.org">eBird</a> is an online tool for recording bird observations. The eBird database contains nearly 500 million sightings records making it among the largest citizen science projects in history and an extremely valuable resource for bird research and conservation. eBird provides free access to data through a variety of means. Some data can be accessed through the <a href="https://confluence.cornell.edu/display/CLOISAPI/eBird+API+1.1">eBird API</a>, which has an associated R pacakge <a href="https://github.com/ropensci/rebird">rebird</a>. In addition, the full eBird database is packaged as a text file and available for download as the <a href="http://ebird.org/ebird/data/download">eBird Basic Dataset (EBD)</a>. For most applications in science or conservation, users will require the EBD, however, working with these data can be challenging because of the inherently large file size. This primary function of this R package is to subset the EBD into smaller pieces, which are more easily manipulated in R.</p>
<div id="the-ebd-and-awk" class="section level2">
<h2 class="hasAnchor">
<a href="#the-ebd-and-awk" class="anchor"></a>The EBD and AWK</h2>
<p>The EBD is a tab separated text file containing every bird sighting in the eBird database at the time of release. Each row corresponds to a sighting of a single species within a checklist and, in addition to the species and number of individuals observed, information is provided at the checklist level (location, time, date, search effort, etc.). Full metadata on the EBD is provided when the <a href="http://ebird.org/ebird/data/download">file is downloaded</a>. Because eBird contains nearly 500 million sightings, the EBD is an inherently large file (~150 GB uncompressed) and therefore challenging to work with in R.</p>
<p>AWK is a unix utility and programming language for processing column formatted text data. It is highly flexible and extremely fast, making it a valuable tool for pre-processing the EBD. Users of the EBD can use AWK to subset the full text file taxonomically, spatially, or temporally, to produce a smaller file, which can then be loaded in to R for visualization, analysis, and modelling. This package is a wrapper for AWK specifically designed for filtering the EBD. The goal is to ease the use of the EBD by removing the hurdle of learning AWK.</p>
<p>Linux and Mac users should already have AWK installed on their machines, however, Windows uses will need to install <a href="https://www.cygwin.com">Cygwin</a> to gain access to AWK.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>This package can be installed directly from GitHub with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"devtools"</span>)
devtools::<span class="kw">install_github</span>(<span class="st">"mstrimas/auk"</span>)</code></pre></div>
</div>
<div id="example-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example usage</h2>
<div id="cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#cleaning" class="anchor"></a>Cleaning</h3>
<p>Some rows in the eBird Basic Dataset (EBD) may have an incorrect number of columns and the dataset has an extra blank column at the end. The function <code><a href="../reference/auk_clean.html">auk_clean()</a></code> drops these erroneous records and removes the blank column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(auk)
<span class="co"># sample data</span>
f &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample_messy.txt"</span>, <span class="dt">package=</span><span class="st">"auk"</span>)
tmp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="co"># remove problem runs</span>
<span class="kw"><a href="../reference/auk_clean.html">auk_clean</a></span>(f, tmp)</code></pre></div>
<pre><code>## [1] "/var/folders/mg/qh40qmqd7376xn8qxd6hm5lwjyy0h2/T//RtmpgAzc5j/filea621404d8632"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># number of lines in input</span>
<span class="kw">length</span>(<span class="kw">readLines</span>(f))</code></pre></div>
<pre><code>## [1] 101</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># number of lines in output</span>
<span class="kw">length</span>(<span class="kw">readLines</span>(tmp))</code></pre></div>
<pre><code>## [1] 96</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unlink</span>(tmp)</code></pre></div>
</div>
<div id="filtering" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering" class="anchor"></a>Filtering</h3>
<p><code>auk</code> uses a <a href="http://r4ds.had.co.nz/pipes.html">pipeline-based workflow</a> for defining filters, which can be compiled into an AWK script. Users should start by defining a reference to the EBD file with <code><a href="../reference/auk_ebd.html">auk_ebd()</a></code>. Then the following filters can be applied:</p>
<ul>
<li>
<code><a href="../reference/auk_species.html">auk_species()</a></code>: filter by species using common or scientific names.</li>
<li>
<code><a href="../reference/auk_country.html">auk_country()</a></code>: filter by country using the standard Engligh name or <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 2-letter country codes</a>.</li>
<li>
<code><a href="../reference/auk_extent.html">auk_extent()</a></code>: filter by spatial extent, i.e. a range of latitudes and longitudes.</li>
<li>
<code><a href="../reference/auk_date.html">auk_date()</a></code>: filter to checklists from a range of dates</li>
<li>
<code><a href="../reference/auk_time.html">auk_time()</a></code>: filter to checklists started during a range of times.</li>
<li>
<code><a href="../reference/auk_duration.html">auk_duration()</a></code>: filter to checklists that lasted a given length of time.</li>
<li>
<code><a href="../reference/auk_complete.html">auk_complete()</a></code>: only retain checklists in which the observer has specified that they recorded all species seen or heard. These records are the most useful for modelling because they provide both presence and absenced data.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sample data</span>
f &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package=</span><span class="st">"auk"</span>)
<span class="co"># define an EBD reference and a set of filters</span>
ebd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>(f) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># species: common and scientific names can be mixed</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) %&gt;%
<span class="st">  </span><span class="co"># country: codes and names can be mixed; case insensitive</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="kw">c</span>(<span class="st">"US"</span>, <span class="st">"Canada"</span>, <span class="st">"mexico"</span>)) %&gt;%
<span class="st">  </span><span class="co"># extent: formatted as `c(lng_min, lat_min, lng_max, lat_max)`</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_extent.html">auk_extent</a></span>(<span class="dt">extent =</span> <span class="kw">c</span>(-<span class="dv">100</span>, <span class="dv">37</span>, -<span class="dv">80</span>, <span class="dv">52</span>)) %&gt;%
<span class="st">  </span><span class="co"># date: use standard ISO date format `"YYYY-MM-DD"`</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_date.html">auk_date</a></span>(<span class="dt">date =</span> <span class="kw">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2012-12-31"</span>)) %&gt;%
<span class="st">  </span><span class="co"># time: 24h format</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_time.html">auk_time</a></span>(<span class="dt">time =</span> <span class="kw">c</span>(<span class="st">"06:00"</span>, <span class="st">"09:00"</span>)) %&gt;%
<span class="st">  </span><span class="co"># duration: length in minutes of checklists</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_duration.html">auk_duration</a></span>(<span class="dt">duration =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) %&gt;%
<span class="st">  </span><span class="co"># complete: all species seen or heard are recorded</span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_complete.html">auk_complete</a></span>()
ebd</code></pre></div>
<pre><code>## Input 
##   EBD: /Library/Frameworks/R.framework/Versions/3.3/Resources/library/auk/extdata/ebd-sample.txt 
## 
## Output 
##   Filters not executed
## 
## Filters 
##   Species: Cyanocitta cristata, Perisoreus canadensis
##   Countries: CA, MX, US
##   Spatial extent: Lat -100 - -80; Lon 37 - 52
##   Date: 2012-01-01 - 2012-12-31
##   Time: 06:00-09:00
##   Laste edited date: all
##   Duration: 0-60 minutes
##   Complete checklists only: yes</code></pre>
<p>In all cases, checks are performed to ensure filters are valid. For example, species are checked against the official <a href="http://help.ebird.org/customer/portal/articles/1006825-the-ebird-taxonomy">eBird taxonomy</a> and countries are checked using the <a href="https://github.com/vincentarelbundock/countrycode"><code>countrycode</code></a> package.</p>
<p>Each of these functions only defines the filter. <code><a href="../reference/auk_filter.html">auk_filter()</a></code> should be used to compile all the filters into an AWK script and execute it to produce an output file. So, bringing all this together, one could, for example, extract all Gray Jay and Blue Jay records from Canada with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
ebd &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package=</span><span class="st">"auk"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(<span class="dt">file =</span> tmp)
<span class="kw">unlink</span>(tmp)</code></pre></div>
</div>
<div id="reading" class="section level3">
<h3 class="hasAnchor">
<a href="#reading" class="anchor"></a>Reading</h3>
<p>EBD files can be read with <code><a href="../reference/read_ebd.html">read_ebd()</a></code>, a wrapper around <code>readr::read_delim()</code>, that uses <code>stringsAsFactors = FALSE</code>, <code>quote = ""</code>, sets column classes, and converts variable names to <code>snake_case</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package=</span><span class="st">"auk"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">str</span>()</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    487 obs. of  47 variables:
##  $ checklist_id              : chr  "S12813888" "S14439115" "S10152130" "S20381156" ...
##  $ global_unique_identifier  : chr  "URN:CornellLabOfOrnithology:EBIRD:OBS179266095" "URN:CornellLabOfOrnithology:EBIRD:OBS201696412" "URN:CornellLabOfOrnithology:EBIRD:OBS144228837" "URN:CornellLabOfOrnithology:EBIRD:OBS278542844" ...
##  $ last_edited_date          : chr  "2013-02-02 15:17:20" "2013-06-18 13:03:16" "2017-03-03 11:30:08" "2014-10-30 15:19:52" ...
##  $ taxonomic_order           : int  18772 18772 18772 18816 18772 18772 18772 18772 18772 18772 ...
##  $ category                  : chr  "species" "species" "species" "species" ...
##  $ common_name               : chr  "Green Jay" "Green Jay" "Green Jay" "Steller's Jay" ...
##  $ scientific_name           : chr  "Cyanocorax yncas" "Cyanocorax yncas" "Cyanocorax yncas" "Cyanocitta stelleri" ...
##  $ subspecies_common_name    : chr  NA NA NA NA ...
##  $ subspecies_scientific_name: chr  NA NA NA NA ...
##  $ observation_count         : chr  "X" "4" "1" "2" ...
##  $ breeding_bird_atlas_code  : chr  NA NA NA NA ...
##  $ age_sex                   : chr  NA NA NA NA ...
##  $ country                   : chr  "Mexico" "Mexico" "Belize" "Mexico" ...
##  $ country_code              : chr  "MX" "MX" "BZ" "MX" ...
##  $ state                     : chr  "Tamaulipas" "Chiapas" "Belize" "Chiapas" ...
##  $ state_code                : chr  "MX-TAM" "MX-CHP" "BZ-BZ" "MX-CHP" ...
##  $ county                    : chr  NA NA NA NA ...
##  $ county_code               : chr  NA NA NA NA ...
##  $ iba_code                  : chr  NA "MX_169" NA "MX_200" ...
##  $ bcr_code                  : int  36 60 NA NA 56 47 60 56 NA 60 ...
##  $ usfws_code                : chr  NA NA NA NA ...
##  $ atlas_block               : chr  NA NA NA NA ...
##  $ locality                  : chr  "Mexico across river from Salineno" "MtySantuario_Punto_10" "Crooked Tree Village west" "San Antonio( Bosque mesofilo Punto 6)" ...
##  $ locality_id               : chr  "L1914289" "L2234972" "L1444745" "L3141369" ...
##  $ locality_type             : chr  "P" "P" "P" "P" ...
##  $ latitude                  : num  26.5 15.7 17.8 15.1 20.9 ...
##  $ longitude                 : num  -99.1 -92.9 -88.5 -92.1 -88.4 ...
##  $ observation_date          : Date, format: "2010-11-12" "2012-05-06" ...
##  $ time_observations_started : chr  "07:20:00" "10:30:00" "06:50:00" "10:30:00" ...
##  $ observer_id               : chr  "obsr347082" "obsr313215" "obsr246930" "obsr354246" ...
##  $ first_name                : chr  "Beth" "MONITORES COMUNITARIOS" "Lee" "CBM" ...
##  $ last_name                 : chr  "eBirder" "eBirder" "eBirder" "eBirder" ...
##  $ sampling_event_identifier : chr  "S12813888" "S14439115" "S10152130" "S20381156" ...
##  $ protocol_type             : chr  "eBird - Stationary Count" "eBird - Traveling Count" "eBird - Traveling Count" "eBird - Stationary Count" ...
##  $ project_code              : chr  "EBIRD" "EBIRD" "EBIRD" "EBIRD" ...
##  $ duration_minutes          : int  40 10 100 10 110 55 10 60 60 10 ...
##  $ effort_distance_km        : num  NA 0.257 1.127 NA 1.2 ...
##  $ effort_area_ha            : num  NA NA NA NA NA ...
##  $ number_observers          : int  20 1 2 4 2 2 1 1 4 1 ...
##  $ all_species_reported      : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
##  $ group_identifier          : chr  NA NA NA NA ...
##  $ has_media                 : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ approved                  : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
##  $ reviewed                  : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ reason                    : chr  NA NA NA NA ...
##  $ trip_comments             : chr  "RGV Bird Festival Trip, viewed from the US side of the river" "Placido Morales Hdz en  Santuario, Angel Albino Corzo, 1556 msnm." "With Glenn Crawford and 3 tourists. Glenn says that the frog calls that are heard nearly everywhere in Belize during the rainy "| __truncated__ "Muestreo realizado por Antonio, Ren� y Evaristo" ...
##  $ species_comments          : chr  NA NA NA NA ...</code></pre>
<p>By default, <code><a href="../reference/read_ebd.html">read_ebd()</a></code> returns a tibble for use with <a href="http://tidyverse.org">Tidyverse</a> packages. Tibbles will behave just like plain data frames in most instances, but users can choose to return a plain <code>data.frame</code> or <code>data.table</code> by using the <code>setclass</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ebd_df &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package=</span><span class="st">"auk"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>(<span class="dt">setclass =</span> <span class="st">"data.frame"</span>)</code></pre></div>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>This package is based on the AWK scripts provided in a presentation given by Wesley Hochachka, Daniel Fink, Tom Auer, and Frank La Sorte at the 2016 NAOC eBird Data Workshop on August 15, 2016.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<pre><code>eBird Basic Dataset. Version: ebd_relFeb-2017. Cornell Lab of Ornithology, Ithaca, New York. May 2013.</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-ebd-and-awk">The EBD and AWK</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#example-usage">Example usage</a></li>
      <li><a href="#acknowledgements">Acknowledgements</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Strimas-Mackey, Eliot Miller, Wesley Hochachka, Cornell Lab of Ornithology.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
